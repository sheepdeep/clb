{{>head}}
<body class="antialiased flex h-full text-base text-foreground bg-background [--header-height:60px] [--sidebar-width:290px] bg-muted! lg:overflow-hidden">
<!-- Theme Mode -->
<script>
    const defaultThemeMode = 'light'; // light|dark|system
    let themeMode;

    if (document.documentElement) {
        if (localStorage.getItem('kt-theme')) {
            themeMode = localStorage.getItem('kt-theme');
        } else if (
                document.documentElement.hasAttribute('data-kt-theme-mode')
        ) {
            themeMode =
                    document.documentElement.getAttribute('data-kt-theme-mode');
        } else {
            themeMode = defaultThemeMode;
        }

        if (themeMode === 'system') {
            themeMode = window.matchMedia('(prefers-color-scheme: dark)').matches
                    ? 'dark'
                    : 'light';
        }

        document.documentElement.classList.add(themeMode);
    }
</script>
<div class="flex grow">
    <header class="flex lg:hidden items-center fixed z-10 top-0 start-0 end-0 shrink-0 bg-muted h-(--header-height)" id="header">
        <!-- Container -->
        <div class="kt-container-fluid flex items-center justify-between flex-wrap gap-3">
            <a href="/metronic/tailwind/demo4/">
                <img class="dark:hidden min-h-[30px]" src="/static/metronic/tailwind/dist/assets/media/app/mini-logo-gray.svg"/>
                <img class="hidden dark:block min-h-[30px]" src="/static/metronic/tailwind/dist/assets/media/app/mini-logo-gray-dark.svg"/>
            </a>
            <button class="kt-btn kt-btn-icon kt-btn-ghost -me-2" data-kt-drawer-toggle="#sidebar">
                <i class="ki-filled ki-menu">
                </i>
            </button>
        </div>
        <!-- End of Container -->
    </header>
    <div class="flex flex-col lg:flex-row grow pt-(--header-height) lg:pt-0">
        {{>nav}}
        <div class="flex grow rounded-xl bg-background border border-input lg:ms-(--sidebar-width) mt-0 lg:mt-5 m-5">
            <div class="flex flex-col grow kt-scrollable-y-auto lg:[--kt-scrollbar-width:auto] pt-5" id="scrollable_content">
                <main class="grow" role="content">
                    <div class="pb-5">
                        <div class="kt-container-fluid flex items-center justify-between flex-wrap gap-3">
                            <div class="flex items-center flex-wrap gap-1 lg:gap-5">
                                <h1 class="font-medium text-base text-mono">
                                    {{ title }}
                                </h1>
                            </div>
                        </div>
                    </div>
                    <div class="kt-container-fluid">
                        <div class="grid gap-5 lg:gap-7.5">
                            <div class="kt-card kt-card-grid min-w-full">
                                <div class="kt-card-header flex-wrap gap-2">
                                    <form>
                                        <div class="flex flex-wrap gap-2 lg:gap-5">
                                            <div class="flex">
                                                <label class="kt-input">
                                                    <i class="ki-filled ki-magnifier">
                                                    </i>
                                                    <input name="search" placeholder="Tìm kiếm" type="text" value="{{ search }}">
                                                </label>
                                            </div>
                                            <div class="flex flex-wrap gap-2.5">
                                                <button class="kt-btn kt-btn-outline kt-btn-primary">
                                                    <i class="ki-filled ki-search-list">
                                                    </i>
                                                    Tìm kiếm
                                                </button>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                                <div class="kt-card-content">
                                    <div data-kt-datatable="true" data-kt-datatable-state-save="false" id="team_crew_table" data-kt-datatable-initialized="true" class="datatable-initialized">
                                        <div class="kt-scrollable-x-auto">
                                            <table class="kt-table table-auto kt-table-border" data-kt-datatable-table="true">
                                                <thead>
                                                <tr>
                                                    <th class="min-w-[150px]">Loại {{{ tableSort query 'gameType' _sort }}}</th>
                                                    <th class="min-w-[150px]">Tên Mini Game {{{ tableSort query 'name' _sort }}}</th>
                                                    <th class="min-w-[150px]">Mô Tả</th>
                                                    <th class="min-w-[150px]">Trưng Bày {{{ tableSort query 'display' _sort }}}</th>
                                                    <th class="min-w-[150px]">Thời Gian {{{ tableSort query 'updatedAt' _sort }}}</th>
                                                    <th class="min-w-[60px]">
                                                        <span data-kt-modal-toggle="#game-add">
                                                            <i class="ki-filled ki-plus-circle" aria-hidden="true"></i>
                                                        </span>
                                                    </th>
                                                </tr>
                                                </thead>
                                                <tbody data-table="game">
                                                {{#each games}}
                                                    <tr class="edit-one" data-id="{{ this._id }}">
                                                        <td data-bs-name="gameType" data-bs-hasEdit="true">
                                                    <span data-bs-table="html" data-bs-value="{{ this.gameType }}">
                                                        <span class="kt-badge kt-badge-secondary" data-bs-html="true">{{
                                                        this.gameType }}</span>
                                                    </span>
                                                            <span class="hidden" data-bs-table="edit" data-bs-value="{{ this.gameType }}">
                                                        <input type="text" class="kt-input mb-2"
                                                               data-bs-edit="true">
                                                    </span>
                                                        </td>
                                                        <td data-bs-name="name" data-bs-hasEdit="true">
                                                    <span data-bs-table="html" data-bs-value="{{ this.name }}">
                                                        <span data-bs-html="true">{{ this.name }}</span>
                                                    </span>
                                                            <span class="hidden" data-bs-table="edit" data-bs-value="{{ this.name }}">
                                                        <input type="text" class="kt-input mb-2"
                                                               data-bs-edit="true">
                                                    </span>
                                                        </td>
                                                        <td data-bs-name="description" data-bs-hasEdit="true">
                                                    <span data-bs-table="html" data-bs-value="{{ this.description }}">
                                                        <textarea class="kt-textarea" data-bs-html="true">{{
                                                        this.description }}</textarea>
                                                    </span>
                                                            <span class="hidden" data-bs-table="edit" data-bs-value="{{ this.description }}">
                                                        <textarea class="kt-textarea mb-2" rows="3"
                                                                  data-bs-edit="true">{{ this.description }}</textarea>
                                                    </span>
                                                        </td>
                                                        <td data-bs-name="display" data-bs-hasEdit="true">
                                                    <span data-bs-table="html" data-bs-value="{{ this.display }}">
                                                        <span data-bs-html="true">
                                                            {{#ifCond this.display '==' 'show'}}
                                                                <span class="kt-badge kt-badge-success">Hiển Thị</span>
                                                            {{else}}
                                                                <span class="kt-badge kt-badge-danger">Ẩn</span>
                                                            {{/ifCond}}
                                                        </span>
                                                    </span>
                                                            <span class="hidden" data-bs-table="edit" data-bs-value="{{ this.display }}">
                                                        <select class="kt-select mb-2"
                                                                data-bs-edit="true">
                                                            <option value="show">Hiển Thị</option>
                                                            <option value="hide">Ẩn</option>
                                                        </select>
                                                    </span>
                                                        </td>
                                                        <td>{{ formatDate this.updatedAt 'HH:mm:ss DD-MM-YYYY'}}</td>
                                                        <td>
                                                            <div class="table-actions hand">
                                                                <a href="reward?search={{ this.gameType }}"
                                                                class="kt-badge kt-badge-warning">
                                                                    <i class="ki-filled ki-eye" aria-hidden="true"></i>
                                                                </a>
                                                                <span class="kt-badge kt-badge-destructive ml-2" data-bs-submit="game"
                                                                      data-bs-action="remove" data-id="{{ this._id }}"><i
                                                                        class="ki-filled ki-trash" aria-hidden="true"></i></span>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                {{else}}
                                                    <tr>
                                                        <td colspan="24" class="text-center py-10">
                                                            <div class="flex flex-col justify-center items-center gap-4 min-h-[150px]">
                                                                <img src="../themes/admin/images/1.png" alt="Rỗng" class="w-20 h-20 object-contain" />
                                                                <p class="text-gray-500 text-base">Không có dữ liệu!</p>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                {{/each}}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </main>
                {{>foot}}
            </div>
        </div>
    </div>
</div>
<div class="kt-modal" data-kt-modal="true" id="game-add" data-bs-modal="momo-add">
    <div class="kt-modal-content max-w-[400px] top-[5%]">
        <div class="kt-modal-header">
            <h3 class="kt-modal-title"> Thêm Mini Game</h3>
            <button
                    type="button"
                    class="kt-modal-close"
                    aria-label="Close modal"
                    data-kt-modal-dismiss="#modal"
            >
                <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        class="lucide lucide-x"
                        aria-hidden="true"
                >
                    <path d="M18 6 6 18"></path>
                    <path d="m6 6 12 12"></path>
                </svg>
            </button>
        </div>
        <div class="kt-modal-body">
            <form action="#" method="post" id="formAdd" class="kt-form">
                <div class="modal-body">
                    <div class="space-y-5">
                        <div class="kt-form-item">
                            <label class="kt-form-label">Tên Mini Game</label>
                            <div class="kt-form-control">
                                <input class="kt-input" name="name" placeholder="Nhập tên mini game">
                            </div>
                        </div>
                        <div class="kt-form-item">
                            <label class="kt-form-label">Loại</label>
                            <div class="kt-form-control">
                                <input class="kt-input" placeholder="Đặt tên loại tùy thích" name="gameType">
                            </div>
                        </div>
                        <div class="kt-form-item">
                            <label class="kt-form-label">Mô Tả</label>
                            <div class="kt-form-control">
                                <textarea class="kt-input" name="description" placeholder="Mô tả trò chơi"></textarea>
                            </div>
                        </div>
                        <div class="kt-form-item">
                            <label class="kt-form-label">Loại ngân hàng</label>
                            <div class="kt-form-control">
                                                        <select name="display" class="kt-select">
                                                            <option value="show">Hiển Thị</option>
                                                            <option value="hide">Ẩn</option>
                                                        </select>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="kt-modal-footer">
                    <div></div>
                    <div class="flex gap-4">
                        <button class="kt-btn kt-btn-secondary" data-kt-modal-dismiss="#modal">Đóng</button>
                        <button type="submit" class="kt-btn kt-btn-primary action-add" data-action="otp">Thêm</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<script src="../themes/admin/assets/js/core.bundle.js">
</script>
<script src="../themes/admin/assets/vendors/ktui/ktui.min.js">
</script>
<script>
    $('body').on('submit', '#formAdd', function (e) {
        e.preventDefault();
        let data = $(this).serialize();


        axios.post(`{{ adminPath }}/bank`, data)
                .then((result) => {
                    let res = result.data;

                    res.success ? swal('Thông báo', res.message, 'success') && setTimeout(() => window.location.reload(), 1500) : swal('Thông báo', res.message, 'error');

                })
                .catch((err) => {
                    $('textarea[name=error]').textContent(err.dataResult);
                    swal('Thông Báo', err.message || err, 'error');
                })
    })
</script>
</html>
