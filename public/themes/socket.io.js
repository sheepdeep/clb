/*!
 * Socket.IO v4.5.3
 * (c) 2014-2022 Guillermo Rauch
 * Released under the MIT License.
 */
!function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory():"function"==typeof define&&define.amd?define(factory):(global="undefined"!=typeof globalThis?globalThis:global||self).io=factory()}(this,(function(){"use strict";function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}function _extends(){return(_extends=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target}).apply(this,arguments)}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&_setPrototypeOf(subClass,superClass)}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _construct(Parent,args,Class){return(_construct=_isNativeReflectConstruct()?Reflect.construct.bind():function _construct(Parent,args,Class){var a=[null];a.push.apply(a,args);var Constructor,instance=new(Function.bind.apply(Parent,a));return Class&&_setPrototypeOf(instance,Class.prototype),instance}).apply(null,arguments)}function _isNativeFunction(fn){return-1!==Function.toString.call(fn).indexOf("[native code]")}function _wrapNativeSuper(Class){var _cache="function"==typeof Map?new Map:void 0;return(_wrapNativeSuper=function _wrapNativeSuper(Class){if(null===Class||!_isNativeFunction(Class))return Class;if("function"!=typeof Class)throw new TypeError("Super expression must either be null or a function");if(void 0!==_cache){if(_cache.has(Class))return _cache.get(Class);_cache.set(Class,Wrapper)}function Wrapper(){return _construct(Class,arguments,_getPrototypeOf(this).constructor)}return Wrapper.prototype=Object.create(Class.prototype,{constructor:{value:Wrapper,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(Wrapper,Class)})(Class)}function _assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}function _possibleConstructorReturn(self,call){if(call&&("object"==typeof call||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(self)}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return _possibleConstructorReturn(this,result)}}function _superPropBase(object,property){for(;!Object.prototype.hasOwnProperty.call(object,property)&&null!==(object=_getPrototypeOf(object)););return object}function _get(){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(target,property,receiver){var base=_superPropBase(target,property);if(base){var desc=Object.getOwnPropertyDescriptor(base,property);return desc.get?desc.get.call(arguments.length<3?target:receiver):desc.value}}).apply(this,arguments)}function _unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _createForOfIteratorHelper(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(!it){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0,F=function(){};return{s:F,n:function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function(e){throw e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var normalCompletion=!0,didErr=!1,err;return{s:function(){it=it.call(o)},n:function(){var step=it.next();return normalCompletion=step.done,step},e:function(e){didErr=!0,err=e},f:function(){try{normalCompletion||null==it.return||it.return()}finally{if(didErr)throw err}}}}var PACKET_TYPES=Object.create(null);PACKET_TYPES.open="0",PACKET_TYPES.close="1",PACKET_TYPES.ping="2",PACKET_TYPES.pong="3",PACKET_TYPES.message="4",PACKET_TYPES.upgrade="5",PACKET_TYPES.noop="6";var PACKET_TYPES_REVERSE=Object.create(null);Object.keys(PACKET_TYPES).forEach((function(key){PACKET_TYPES_REVERSE[PACKET_TYPES[key]]=key}));for(var ERROR_PACKET={type:"error",data:"parser error"},withNativeBlob$1="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),withNativeArrayBuffer$2="function"==typeof ArrayBuffer,isView$1=function isView(obj){return"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(obj):obj&&obj.buffer instanceof ArrayBuffer},encodePacket=function encodePacket(_ref,supportsBinary,callback){var type=_ref.type,data=_ref.data;return withNativeBlob$1&&data instanceof Blob?supportsBinary?callback(data):encodeBlobAsBase64(data,callback):withNativeArrayBuffer$2&&(data instanceof ArrayBuffer||isView$1(data))?supportsBinary?callback(data):encodeBlobAsBase64(new Blob([data]),callback):callback(PACKET_TYPES[type]+(data||""))},encodeBlobAsBase64=function encodeBlobAsBase64(data,callback){var fileReader=new FileReader;return fileReader.onload=function(){var content=fileReader.result.split(",")[1];callback("b"+content)},fileReader.readAsDataURL(data)},chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",lookup$1="undefined"==typeof Uint8Array?[]:new Uint8Array(256),i$1=0;i$1<chars.length;i$1++)lookup$1[chars.charCodeAt(i$1)]=i$1;var decode$1=function decode(base64){var bufferLength=.75*base64.length,len=base64.length,i,p=0,encoded1,encoded2,encoded3,encoded4;"="===base64[base64.length-1]&&(bufferLength--,"="===base64[base64.length-2]&&bufferLength--);var arraybuffer=new ArrayBuffer(bufferLength),bytes=new Uint8Array(arraybuffer);for(i=0;i<len;i+=4)encoded1=lookup$1[base64.charCodeAt(i)],encoded2=lookup$1[base64.charCodeAt(i+1)],encoded3=lookup$1[base64.charCodeAt(i+2)],encoded4=lookup$1[base64.charCodeAt(i+3)],bytes[p++]=encoded1<<2|encoded2>>4,bytes[p++]=(15&encoded2)<<4|encoded3>>2,bytes[p++]=(3&encoded3)<<6|63&encoded4;return arraybuffer},withNativeArrayBuffer$1="function"==typeof ArrayBuffer,decodePacket=function decodePacket(encodedPacket,binaryType){if("string"!=typeof encodedPacket)return{type:"message",data:mapBinary(encodedPacket,binaryType)};var type=encodedPacket.charAt(0),packetType;return"b"===type?{type:"message",data:decodeBase64Packet(encodedPacket.substring(1),binaryType)}:PACKET_TYPES_REVERSE[type]?encodedPacket.length>1?{type:PACKET_TYPES_REVERSE[type],data:encodedPacket.substring(1)}:{type:PACKET_TYPES_REVERSE[type]}:ERROR_PACKET},decodeBase64Packet=function decodeBase64Packet(data,binaryType){if(withNativeArrayBuffer$1){var decoded=decode$1(data);return mapBinary(decoded,binaryType)}return{base64:!0,data:data}},mapBinary=function mapBinary(data,binaryType){switch(binaryType){case"blob":return data instanceof ArrayBuffer?new Blob([data]):data;case"arraybuffer":default:return data}},SEPARATOR=String.fromCharCode(30),encodePayload=function encodePayload(packets,callback){var length=packets.length,encodedPackets=new Array(length),count=0;packets.forEach((function(packet,i){encodePacket(packet,!1,(function(encodedPacket){encodedPackets[i]=encodedPacket,++count===length&&callback(encodedPackets.join(SEPARATOR))}))}))},decodePayload=function decodePayload(encodedPayload,binaryType){for(var encodedPackets=encodedPayload.split(SEPARATOR),packets=[],i=0;i<encodedPackets.length;i++){var decodedPacket=decodePacket(encodedPackets[i],binaryType);if(packets.push(decodedPacket),"error"===decodedPacket.type)break}return packets},protocol$1=4;function Emitter(obj){if(obj)return mixin(obj)}function mixin(obj){for(var key in Emitter.prototype)obj[key]=Emitter.prototype[key];return obj}Emitter.prototype.on=Emitter.prototype.addEventListener=function(event,fn){return this._callbacks=this._callbacks||{},(this._callbacks["$"+event]=this._callbacks["$"+event]||[]).push(fn),this},Emitter.prototype.once=function(event,fn){function on(){this.off(event,on),fn.apply(this,arguments)}return on.fn=fn,this.on(event,on),this},Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(event,fn){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var callbacks=this._callbacks["$"+event],cb;if(!callbacks)return this;if(1==arguments.length)return delete this._callbacks["$"+event],this;for(var i=0;i<callbacks.length;i++)if((cb=callbacks[i])===fn||cb.fn===fn){callbacks.splice(i,1);break}return 0===callbacks.length&&delete this._callbacks["$"+event],this},Emitter.prototype.emit=function(event){this._callbacks=this._callbacks||{};for(var args=new Array(arguments.length-1),callbacks=this._callbacks["$"+event],i=1;i<arguments.length;i++)args[i-1]=arguments[i];if(callbacks)for(var i=0,len=(callbacks=callbacks.slice(0)).length;i<len;++i)callbacks[i].apply(this,args);return this},Emitter.prototype.emitReserved=Emitter.prototype.emit,Emitter.prototype.listeners=function(event){return this._callbacks=this._callbacks||{},this._callbacks["$"+event]||[]},Emitter.prototype.hasListeners=function(event){return!!this.listeners(event).length};var globalThisShim="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")();function pick(obj){for(var _len=arguments.length,attr=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)attr[_key-1]=arguments[_key];return attr.reduce((function(acc,k){return obj.hasOwnProperty(k)&&(acc[k]=obj[k]),acc}),{})}var NATIVE_SET_TIMEOUT=setTimeout,NATIVE_CLEAR_TIMEOUT=clearTimeout;function installTimerFunctions(obj,opts){opts.useNativeTimers?(obj.setTimeoutFn=NATIVE_SET_TIMEOUT.bind(globalThisShim),obj.clearTimeoutFn=NATIVE_CLEAR_TIMEOUT.bind(globalThisShim)):(obj.setTimeoutFn=setTimeout.bind(globalThisShim),obj.clearTimeoutFn=clearTimeout.bind(globalThisShim))}var BASE64_OVERHEAD=1.33;function byteLength(obj){return"string"==typeof obj?utf8Length(obj):Math.ceil(1.33*(obj.byteLength||obj.size))}function utf8Length(str){for(var c=0,length=0,i=0,l=str.length;i<l;i++)(c=str.charCodeAt(i))<128?length+=1:c<2048?length+=2:c<55296||c>=57344?length+=3:(i++,length+=4);return length}var TransportError=function(_Error){_inherits(TransportError,_Error);var _super=_createSuper(TransportError);function TransportError(reason,description,context){var _this;return _classCallCheck(this,TransportError),(_this=_super.call(this,reason)).description=description,_this.context=context,_this.type="TransportError",_this}return _createClass(TransportError)}(_wrapNativeSuper(Error)),Transport=function(_Emitter){_inherits(Transport,_Emitter);var _super2=_createSuper(Transport);function Transport(opts){var _this2;return _classCallCheck(this,Transport),(_this2=_super2.call(this)).writable=!1,installTimerFunctions(_assertThisInitialized(_this2),opts),_this2.opts=opts,_this2.query=opts.query,_this2.readyState="",_this2.socket=opts.socket,_this2}return _createClass(Transport,[{key:"onError",value:function onError(reason,description,context){return _get(_getPrototypeOf(Transport.prototype),"emitReserved",this).call(this,"error",new TransportError(reason,description,context)),this}},{key:"open",value:function open(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this}},{key:"close",value:function close(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}},{key:"send",value:function send(packets){"open"===this.readyState&&this.write(packets)}},{key:"onOpen",value:function onOpen(){this.readyState="open",this.writable=!0,_get(_getPrototypeOf(Transport.prototype),"emitReserved",this).call(this,"open")}},{key:"onData",value:function onData(data){var packet=decodePacket(data,this.socket.binaryType);this.onPacket(packet)}},{key:"onPacket",value:function onPacket(packet){_get(_getPrototypeOf(Transport.prototype),"emitReserved",this).call(this,"packet",packet)}},{key:"onClose",value:function onClose(details){this.readyState="closed",_get(_getPrototypeOf(Transport.prototype),"emitReserved",this).call(this,"close",details)}}]),Transport}(Emitter),alphabet="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),length=64,map={},seed=0,i=0,prev;function encode$1(num){var encoded="";do{encoded=alphabet[num%64]+encoded,num=Math.floor(num/64)}while(num>0);return encoded}function yeast(){var now=encode$1(+new Date);return now!==prev?(seed=0,prev=now):now+"."+encode$1(seed++)}for(;i<64;i++)map[alphabet[i]]=i;function encode(obj){var str="";for(var i in obj)obj.hasOwnProperty(i)&&(str.length&&(str+="&"),str+=encodeURIComponent(i)+"="+encodeURIComponent(obj[i]));return str}function decode(qs){for(var qry={},pairs=qs.split("&"),i=0,l=pairs.length;i<l;i++){var pair=pairs[i].split("=");qry[decodeURIComponent(pair[0])]=decodeURIComponent(pair[1])}return qry}var value=!1;try{value="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(err){}var hasCORS=value;function XHR(opts){var xdomain=opts.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!xdomain||hasCORS))return new XMLHttpRequest}catch(e){}if(!xdomain)try{return new(globalThisShim[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}function empty(){}var hasXHR2=null!=new XHR({xdomain:!1}).responseType,xhr,Polling=function(_Transport){_inherits(Polling,_Transport);var _super=_createSuper(Polling);function Polling(opts){var _this;if(_classCallCheck(this,Polling),(_this=_super.call(this,opts)).polling=!1,"undefined"!=typeof location){var isSSL="https:"===location.protocol,port=location.port;port||(port=isSSL?"443":"80"),_this.xd="undefined"!=typeof location&&opts.hostname!==location.hostname||port!==opts.port,_this.xs=opts.secure!==isSSL}var forceBase64=opts&&opts.forceBase64;return _this.supportsBinary=hasXHR2&&!forceBase64,_this}return _createClass(Polling,[{key:"name",get:function get(){return"polling"}},{key:"doOpen",value:function doOpen(){this.poll()}},{key:"pause",value:function pause(onPause){var _this2=this;this.readyState="pausing";var pause=function pause(){_this2.readyState="paused",onPause()};if(this.polling||!this.writable){var total=0;this.polling&&(total++,this.once("pollComplete",(function(){--total||pause()}))),this.writable||(total++,this.once("drain",(function(){--total||pause()})))}else pause()}},{key:"poll",value:function poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}},{key:"onData",value:function onData(data){var _this3=this,callback=function callback(packet){if("opening"===_this3.readyState&&"open"===packet.type&&_this3.onOpen(),"close"===packet.type)return _this3.onClose({description:"transport closed by the server"}),!1;_this3.onPacket(packet)};decodePayload(data,this.socket.binaryType).forEach(callback),"closed"!==this.readyState&&(this.polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this.poll())}},{key:"doClose",value:function doClose(){var _this4=this,close=function close(){_this4.write([{type:"close"}])};"open"===this.readyState?close():this.once("open",close)}},{key:"write",value:function write(packets){var _this5=this;this.writable=!1,encodePayload(packets,(function(data){_this5.doWrite(data,(function(){_this5.writable=!0,_this5.emitReserved("drain")}))}))}},{key:"uri",value:function uri(){var query=this.query||{},schema=this.opts.secure?"https":"http",port="";!1!==this.opts.timestampRequests&&(query[this.opts.timestampParam]=yeast()),this.supportsBinary||query.sid||(query.b64=1),this.opts.port&&("https"===schema&&443!==Number(this.opts.port)||"http"===schema&&80!==Number(this.opts.port))&&(port=":"+this.opts.port);var encodedQuery=encode(query),ipv6;return schema+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+port+this.opts.path+(encodedQuery.length?"?"+encodedQuery:"")}},{key:"request",value:function request(){var opts=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _extends(opts,{xd:this.xd,xs:this.xs},this.opts),new Request(this.uri(),opts)}},{key:"doWrite",value:function doWrite(data,fn){var _this6=this,req=this.request({method:"POST",data:data});req.on("success",fn),req.on("error",(function(xhrStatus,context){_this6.onError("xhr post error",xhrStatus,context)}))}},{key:"doPoll",value:function doPoll(){var _this7=this,req=this.request();req.on("data",this.onData.bind(this)),req.on("error",(function(xhrStatus,context){_this7.onError("xhr poll error",xhrStatus,context)})),this.pollXhr=req}}]),Polling}(Transport),Request=function(_Emitter){_inherits(Request,_Emitter);var _super2=_createSuper(Request);function Request(uri,opts){var _this8;return _classCallCheck(this,Request),installTimerFunctions(_assertThisInitialized(_this8=_super2.call(this)),opts),_this8.opts=opts,_this8.method=opts.method||"GET",_this8.uri=uri,_this8.async=!1!==opts.async,_this8.data=void 0!==opts.data?opts.data:null,_this8.create(),_this8}return _createClass(Request,[{key:"create",value:function create(){var _this9=this,opts=pick(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");opts.xdomain=!!this.opts.xd,opts.xscheme=!!this.opts.xs;var xhr=this.xhr=new XHR(opts);try{xhr.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders)for(var i in xhr.setDisableHeaderCheck&&xhr.setDisableHeaderCheck(!0),this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(i)&&xhr.setRequestHeader(i,this.opts.extraHeaders[i])}catch(e){}if("POST"===this.method)try{xhr.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{xhr.setRequestHeader("Accept","*/*")}catch(e){}"withCredentials"in xhr&&(xhr.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(xhr.timeout=this.opts.requestTimeout),xhr.onreadystatechange=function(){4===xhr.readyState&&(200===xhr.status||1223===xhr.status?_this9.onLoad():_this9.setTimeoutFn((function(){_this9.onError("number"==typeof xhr.status?xhr.status:0)}),0))},xhr.send(this.data)}catch(e){return void this.setTimeoutFn((function(){_this9.onError(e)}),0)}"undefined"!=typeof document&&(this.index=Request.requestsCount++,Request.requests[this.index]=this)}},{key:"onError",value:function onError(err){this.emitReserved("error",err,this.xhr),this.cleanup(!0)}},{key:"cleanup",value:function cleanup(fromError){if(void 0!==this.xhr&&null!==this.xhr){if(this.xhr.onreadystatechange=empty,fromError)try{this.xhr.abort()}catch(e){}"undefined"!=typeof document&&delete Request.requests[this.index],this.xhr=null}}},{key:"onLoad",value:function onLoad(){var data=this.xhr.responseText;null!==data&&(this.emitReserved("data",data),this.emitReserved("success"),this.cleanup())}},{key:"abort",value:function abort(){this.cleanup()}}]),Request}(Emitter);if(Request.requestsCount=0,Request.requests={},"undefined"!=typeof document)if("function"==typeof attachEvent)attachEvent("onunload",unloadHandler);else if("function"==typeof addEventListener){var terminationEvent;addEventListener("onpagehide"in globalThisShim?"pagehide":"unload",unloadHandler,!1)}function unloadHandler(){for(var i in Request.requests)Request.requests.hasOwnProperty(i)&&Request.requests[i].abort()}var nextTick="function"==typeof Promise&&"function"==typeof Promise.resolve?function(cb){return Promise.resolve().then(cb)}:function(cb,setTimeoutFn){return setTimeoutFn(cb,0)},isPromiseAvailable,WebSocket=globalThisShim.WebSocket||globalThisShim.MozWebSocket,usingBrowserWebSocket=!0,defaultBinaryType="arraybuffer",isReactNative="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),WS,transports={websocket:function(_Transport){_inherits(WS,_Transport);var _super=_createSuper(WS);function WS(opts){var _this;return _classCallCheck(this,WS),(_this=_super.call(this,opts)).supportsBinary=!opts.forceBase64,_this}return _createClass(WS,[{key:"name",get:function get(){return"websocket"}},{key:"doOpen",value:function doOpen(){if(this.check()){var uri=this.uri(),protocols=this.opts.protocols,opts=isReactNative?{}:pick(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(opts.headers=this.opts.extraHeaders);try{this.ws=isReactNative?new WebSocket(uri,protocols,opts):protocols?new WebSocket(uri,protocols):new WebSocket(uri)}catch(err){return this.emitReserved("error",err)}this.ws.binaryType=this.socket.binaryType||"arraybuffer",this.addEventListeners()}}},{key:"addEventListeners",value:function addEventListeners(){var _this2=this;this.ws.onopen=function(){_this2.opts.autoUnref&&_this2.ws._socket.unref(),_this2.onOpen()},this.ws.onclose=function(closeEvent){return _this2.onClose({description:"websocket connection closed",context:closeEvent})},this.ws.onmessage=function(ev){return _this2.onData(ev.data)},this.ws.onerror=function(e){return _this2.onError("websocket error",e)}}},{key:"write",value:function write(packets){var _this3=this;this.writable=!1;for(var _loop=function _loop(i){var packet=packets[i],lastPacket=i===packets.length-1;encodePacket(packet,_this3.supportsBinary,(function(data){try{_this3.ws.send(data)}catch(e){}lastPacket&&nextTick((function(){_this3.writable=!0,_this3.emitReserved("drain")}),_this3.setTimeoutFn)}))},i=0;i<packets.length;i++)_loop(i)}},{key:"doClose",value:function doClose(){void 0!==this.ws&&(this.ws.close(),this.ws=null)}},{key:"uri",value:function uri(){var query=this.query||{},schema=this.opts.secure?"wss":"ws",port="";this.opts.port&&("wss"===schema&&443!==Number(this.opts.port)||"ws"===schema&&80!==Number(this.opts.port))&&(port=":"+this.opts.port),this.opts.timestampRequests&&(query[this.opts.timestampParam]=yeast()),this.supportsBinary||(query.b64=1);var encodedQuery=encode(query),ipv6;return schema+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+port+this.opts.path+(encodedQuery.length?"?"+encodedQuery:"")}},{key:"check",value:function check(){return!!WebSocket}}]),WS}(Transport),polling:Polling},re=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,parts=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function parse(str){var src=str,b=str.indexOf("["),e=str.indexOf("]");-1!=b&&-1!=e&&(str=str.substring(0,b)+str.substring(b,e).replace(/:/g,";")+str.substring(e,str.length));for(var m=re.exec(str||""),uri={},i=14;i--;)uri[parts[i]]=m[i]||"";return-1!=b&&-1!=e&&(uri.source=src,uri.host=uri.host.substring(1,uri.host.length-1).replace(/;/g,":"),uri.authority=uri.authority.replace("[","").replace("]","").replace(/;/g,":"),uri.ipv6uri=!0),uri.pathNames=pathNames(uri,uri.path),uri.queryKey=queryKey(uri,uri.query),uri}function pathNames(obj,path){var regx=/\/{2,9}/g,names=path.replace(regx,"/").split("/");return"/"!=path.slice(0,1)&&0!==path.length||names.splice(0,1),"/"==path.slice(-1)&&names.splice(names.length-1,1),names}function queryKey(uri,query){var data={};return query.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function($0,$1,$2){$1&&(data[$1]=$2)})),data}var Socket$1=function(_Emitter){_inherits(Socket,_Emitter);var _super=_createSuper(Socket);function Socket(uri){var _this,opts=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return _classCallCheck(this,Socket),_this=_super.call(this),uri&&"object"===_typeof(uri)&&(opts=uri,uri=null),uri?(uri=parse(uri),opts.hostname=uri.host,opts.secure="https"===uri.protocol||"wss"===uri.protocol,opts.port=uri.port,uri.query&&(opts.query=uri.query)):opts.host&&(opts.hostname=parse(opts.host).host),installTimerFunctions(_assertThisInitialized(_this),opts),_this.secure=null!=opts.secure?opts.secure:"undefined"!=typeof location&&"https:"===location.protocol,opts.hostname&&!opts.port&&(opts.port=_this.secure?"443":"80"),_this.hostname=opts.hostname||("undefined"!=typeof location?location.hostname:"localhost"),_this.port=opts.port||("undefined"!=typeof location&&location.port?location.port:_this.secure?"443":"80"),_this.transports=opts.transports||["polling","websocket"],_this.readyState="",_this.writeBuffer=[],_this.prevBufferLen=0,_this.opts=_extends({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},opts),_this.opts.path=_this.opts.path.replace(/\/$/,"")+"/","string"==typeof _this.opts.query&&(_this.opts.query=decode(_this.opts.query)),_this.id=null,_this.upgrades=null,_this.pingInterval=null,_this.pingTimeout=null,_this.pingTimeoutTimer=null,"function"==typeof addEventListener&&(_this.opts.closeOnBeforeunload&&(_this.beforeunloadEventListener=function(){_this.transport&&(_this.transport.removeAllListeners(),_this.transport.close())},addEventListener("beforeunload",_this.beforeunloadEventListener,!1)),"localhost"!==_this.hostname&&(_this.offlineEventListener=function(){_this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",_this.offlineEventListener,!1))),_this.open(),_this}return _createClass(Socket,[{key:"createTransport",value:function createTransport(name){var query=_extends({},this.opts.query);query.EIO=4,query.transport=name,this.id&&(query.sid=this.id);var opts=_extends({},this.opts.transportOptions[name],this.opts,{query:query,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new transports[name](opts)}},{key:"open",value:function open(){var _this2=this,transport;if(this.opts.rememberUpgrade&&Socket.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))transport="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn((function(){_this2.emitReserved("error","No transports available")}),0);transport=this.transports[0]}this.readyState="opening";try{transport=this.createTransport(transport)}catch(e){return this.transports.shift(),void this.open()}transport.open(),this.setTransport(transport)}},{key:"setTransport",value:function setTransport(transport){var _this3=this;this.transport&&this.transport.removeAllListeners(),this.transport=transport,transport.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",(function(reason){return _this3.onClose("transport close",reason)}))}},{key:"probe",value:function probe(name){var _this4=this,transport=this.createTransport(name),failed=!1;Socket.priorWebsocketSuccess=!1;var onTransportOpen=function onTransportOpen(){failed||(transport.send([{type:"ping",data:"probe"}]),transport.once("packet",(function(msg){if(!failed)if("pong"===msg.type&&"probe"===msg.data){if(_this4.upgrading=!0,_this4.emitReserved("upgrading",transport),!transport)return;Socket.priorWebsocketSuccess="websocket"===transport.name,_this4.transport.pause((function(){failed||"closed"!==_this4.readyState&&(cleanup(),_this4.setTransport(transport),transport.send([{type:"upgrade"}]),_this4.emitReserved("upgrade",transport),transport=null,_this4.upgrading=!1,_this4.flush())}))}else{var err=new Error("probe error");err.transport=transport.name,_this4.emitReserved("upgradeError",err)}})))};function freezeTransport(){failed||(failed=!0,cleanup(),transport.close(),transport=null)}var onerror=function onerror(err){var error=new Error("probe error: "+err);error.transport=transport.name,freezeTransport(),_this4.emitReserved("upgradeError",error)};function onTransportClose(){onerror("transport closed")}function onclose(){onerror("socket closed")}function onupgrade(to){transport&&to.name!==transport.name&&freezeTransport()}var cleanup=function cleanup(){transport.removeListener("open",onTransportOpen),transport.removeListener("error",onerror),transport.removeListener("close",onTransportClose),_this4.off("close",onclose),_this4.off("upgrading",onupgrade)};transport.once("open",onTransportOpen),transport.once("error",onerror),transport.once("close",onTransportClose),this.once("close",onclose),this.once("upgrading",onupgrade),transport.open()}},{key:"onOpen",value:function onOpen(){if(this.readyState="open",Socket.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade&&this.transport.pause)for(var i=0,l=this.upgrades.length;i<l;i++)this.probe(this.upgrades[i])}},{key:"onPacket",value:function onPacket(packet){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",packet),this.emitReserved("heartbeat"),packet.type){case"open":this.onHandshake(JSON.parse(packet.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":var err=new Error("server error");err.code=packet.data,this.onError(err);break;case"message":this.emitReserved("data",packet.data),this.emitReserved("message",packet.data)}}},{key:"onHandshake",value:function onHandshake(data){this.emitReserved("handshake",data),this.id=data.sid,this.transport.query.sid=data.sid,this.upgrades=this.filterUpgrades(data.upgrades),this.pingInterval=data.pingInterval,this.pingTimeout=data.pingTimeout,this.maxPayload=data.maxPayload,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}},{key:"resetPingTimeout",value:function resetPingTimeout(){var _this5=this;this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn((function(){_this5.onClose("ping timeout")}),this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}},{key:"onDrain",value:function onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}},{key:"flush",value:function flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){var packets=this.getWritablePackets();this.transport.send(packets),this.prevBufferLen=packets.length,this.emitReserved("flush")}}},{key:"getWritablePackets",value:function getWritablePackets(){var shouldCheckPayloadSize;if(!(this.maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;for(var payloadSize=1,i=0;i<this.writeBuffer.length;i++){var data=this.writeBuffer[i].data;if(data&&(payloadSize+=byteLength(data)),i>0&&payloadSize>this.maxPayload)return this.writeBuffer.slice(0,i);payloadSize+=2}return this.writeBuffer}},{key:"write",value:function write(msg,options,fn){return this.sendPacket("message",msg,options,fn),this}},{key:"send",value:function send(msg,options,fn){return this.sendPacket("message",msg,options,fn),this}},{key:"sendPacket",value:function sendPacket(type,data,options,fn){if("function"==typeof data&&(fn=data,data=void 0),"function"==typeof options&&(fn=options,options=null),"closing"!==this.readyState&&"closed"!==this.readyState){(options=options||{}).compress=!1!==options.compress;var packet={type:type,data:data,options:options};this.emitReserved("packetCreate",packet),this.writeBuffer.push(packet),fn&&this.once("flush",fn),this.flush()}}},{key:"close",value:function close(){var _this6=this,close=function close(){_this6.onClose("forced close"),_this6.transport.close()},cleanupAndClose=function cleanupAndClose(){_this6.off("upgrade",cleanupAndClose),_this6.off("upgradeError",cleanupAndClose),close()},waitForUpgrade=function waitForUpgrade(){_this6.once("upgrade",cleanupAndClose),_this6.once("upgradeError",cleanupAndClose)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",(function(){_this6.upgrading?waitForUpgrade():close()})):this.upgrading?waitForUpgrade():close()),this}},{key:"onError",value:function onError(err){Socket.priorWebsocketSuccess=!1,this.emitReserved("error",err),this.onClose("transport error",err)}},{key:"onClose",value:function onClose(reason,description){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",reason,description),this.writeBuffer=[],this.prevBufferLen=0)}},{key:"filterUpgrades",value:function filterUpgrades(upgrades){for(var filteredUpgrades=[],i=0,j=upgrades.length;i<j;i++)~this.transports.indexOf(upgrades[i])&&filteredUpgrades.push(upgrades[i]);return filteredUpgrades}}]),Socket}(Emitter);function url(uri){var path=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",loc=arguments.length>2?arguments[2]:void 0,obj=uri;loc=loc||"undefined"!=typeof location&&location,null==uri&&(uri=loc.protocol+"//"+loc.host),"string"==typeof uri&&("/"===uri.charAt(0)&&(uri="/"===uri.charAt(1)?loc.protocol+uri:loc.host+uri),/^(https?|wss?):\/\//.test(uri)||(uri=void 0!==loc?loc.protocol+"//"+uri:"https://"+uri),obj=parse(uri)),obj.port||(/^(http|ws)$/.test(obj.protocol)?obj.port="80":/^(http|ws)s$/.test(obj.protocol)&&(obj.port="443")),obj.path=obj.path||"/";var ipv6=-1!==obj.host.indexOf(":"),host=ipv6?"["+obj.host+"]":obj.host;return obj.id=obj.protocol+"://"+host+":"+obj.port+path,obj.href=obj.protocol+"://"+host+(loc&&loc.port===obj.port?"":":"+obj.port),obj}Socket$1.protocol=4,Socket$1.protocol;var withNativeArrayBuffer="function"==typeof ArrayBuffer,isView=function isView(obj){return"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(obj):obj.buffer instanceof ArrayBuffer},toString=Object.prototype.toString,withNativeBlob="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===toString.call(Blob),withNativeFile="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===toString.call(File);function isBinary(obj){return withNativeArrayBuffer&&(obj instanceof ArrayBuffer||isView(obj))||withNativeBlob&&obj instanceof Blob||withNativeFile&&obj instanceof File}function hasBinary(obj,toJSON){if(!obj||"object"!==_typeof(obj))return!1;if(Array.isArray(obj)){for(var i=0,l=obj.length;i<l;i++)if(hasBinary(obj[i]))return!0;return!1}if(isBinary(obj))return!0;if(obj.toJSON&&"function"==typeof obj.toJSON&&1===arguments.length)return hasBinary(obj.toJSON(),!0);for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)&&hasBinary(obj[key]))return!0;return!1}function deconstructPacket(packet){var buffers=[],packetData=packet.data,pack=packet;return pack.data=_deconstructPacket(packetData,buffers),pack.attachments=buffers.length,{packet:pack,buffers:buffers}}function _deconstructPacket(data,buffers){if(!data)return data;if(isBinary(data)){var placeholder={_placeholder:!0,num:buffers.length};return buffers.push(data),placeholder}if(Array.isArray(data)){for(var newData=new Array(data.length),i=0;i<data.length;i++)newData[i]=_deconstructPacket(data[i],buffers);return newData}if("object"===_typeof(data)&&!(data instanceof Date)){var _newData={};for(var key in data)Object.prototype.hasOwnProperty.call(data,key)&&(_newData[key]=_deconstructPacket(data[key],buffers));return _newData}return data}function reconstructPacket(packet,buffers){return packet.data=_reconstructPacket(packet.data,buffers),packet.attachments=void 0,packet}function _reconstructPacket(data,buffers){if(!data)return data;if(data&&data._placeholder)return buffers[data.num];if(Array.isArray(data))for(var i=0;i<data.length;i++)data[i]=_reconstructPacket(data[i],buffers);else if("object"===_typeof(data))for(var key in data)Object.prototype.hasOwnProperty.call(data,key)&&(data[key]=_reconstructPacket(data[key],buffers));return data}var protocol=5,PacketType;!function(PacketType){PacketType[PacketType.CONNECT=0]="CONNECT",PacketType[PacketType.DISCONNECT=1]="DISCONNECT",PacketType[PacketType.EVENT=2]="EVENT",PacketType[PacketType.ACK=3]="ACK",PacketType[PacketType.CONNECT_ERROR=4]="CONNECT_ERROR",PacketType[PacketType.BINARY_EVENT=5]="BINARY_EVENT",PacketType[PacketType.BINARY_ACK=6]="BINARY_ACK"}(PacketType||(PacketType={}));var Encoder=function(){function Encoder(replacer){_classCallCheck(this,Encoder),this.replacer=replacer}return _createClass(Encoder,[{key:"encode",value:function encode(obj){return obj.type!==PacketType.EVENT&&obj.type!==PacketType.ACK||!hasBinary(obj)?[this.encodeAsString(obj)]:(obj.type=obj.type===PacketType.EVENT?PacketType.BINARY_EVENT:PacketType.BINARY_ACK,this.encodeAsBinary(obj))}},{key:"encodeAsString",value:function encodeAsString(obj){var str=""+obj.type;return obj.type!==PacketType.BINARY_EVENT&&obj.type!==PacketType.BINARY_ACK||(str+=obj.attachments+"-"),obj.nsp&&"/"!==obj.nsp&&(str+=obj.nsp+","),null!=obj.id&&(str+=obj.id),null!=obj.data&&(str+=JSON.stringify(obj.data,this.replacer)),str}},{key:"encodeAsBinary",value:function encodeAsBinary(obj){var deconstruction=deconstructPacket(obj),pack=this.encodeAsString(deconstruction.packet),buffers=deconstruction.buffers;return buffers.unshift(pack),buffers}}]),Encoder}(),Decoder=function(_Emitter){_inherits(Decoder,_Emitter);var _super=_createSuper(Decoder);function Decoder(reviver){var _this;return _classCallCheck(this,Decoder),(_this=_super.call(this)).reviver=reviver,_this}return _createClass(Decoder,[{key:"add",value:function add(obj){var packet;if("string"==typeof obj)(packet=this.decodeString(obj)).type===PacketType.BINARY_EVENT||packet.type===PacketType.BINARY_ACK?(this.reconstructor=new BinaryReconstructor(packet),0===packet.attachments&&_get(_getPrototypeOf(Decoder.prototype),"emitReserved",this).call(this,"decoded",packet)):_get(_getPrototypeOf(Decoder.prototype),"emitReserved",this).call(this,"decoded",packet);else{if(!isBinary(obj)&&!obj.base64)throw new Error("Unknown type: "+obj);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(packet=this.reconstructor.takeBinaryData(obj))&&(this.reconstructor=null,_get(_getPrototypeOf(Decoder.prototype),"emitReserved",this).call(this,"decoded",packet))}}},{key:"decodeString",value:function decodeString(str){var i=0,p={type:Number(str.charAt(0))};if(void 0===PacketType[p.type])throw new Error("unknown packet type "+p.type);if(p.type===PacketType.BINARY_EVENT||p.type===PacketType.BINARY_ACK){for(var start=i+1;"-"!==str.charAt(++i)&&i!=str.length;);var buf=str.substring(start,i);if(buf!=Number(buf)||"-"!==str.charAt(i))throw new Error("Illegal attachments");p.attachments=Number(buf)}if("/"===str.charAt(i+1)){for(var _start=i+1;++i;){var c;if(","===str.charAt(i))break;if(i===str.length)break}p.nsp=str.substring(_start,i)}else p.nsp="/";var next=str.charAt(i+1);if(""!==next&&Number(next)==next){for(var _start2=i+1;++i;){var _c=str.charAt(i);if(null==_c||Number(_c)!=_c){--i;break}if(i===str.length)break}p.id=Number(str.substring(_start2,i+1))}if(str.charAt(++i)){var payload=this.tryParse(str.substr(i));if(!Decoder.isPayloadValid(p.type,payload))throw new Error("invalid payload");p.data=payload}return p}},{key:"tryParse",value:function tryParse(str){try{return JSON.parse(str,this.reviver)}catch(e){return!1}}},{key:"destroy",value:function destroy(){this.reconstructor&&this.reconstructor.finishedReconstruction()}}],[{key:"isPayloadValid",value:function isPayloadValid(type,payload){switch(type){case PacketType.CONNECT:return"object"===_typeof(payload);case PacketType.DISCONNECT:return void 0===payload;case PacketType.CONNECT_ERROR:return"string"==typeof payload||"object"===_typeof(payload);case PacketType.EVENT:case PacketType.BINARY_EVENT:return Array.isArray(payload)&&payload.length>0;case PacketType.ACK:case PacketType.BINARY_ACK:return Array.isArray(payload)}}}]),Decoder}(Emitter),BinaryReconstructor=function(){function BinaryReconstructor(packet){_classCallCheck(this,BinaryReconstructor),this.packet=packet,this.buffers=[],this.reconPack=packet}return _createClass(BinaryReconstructor,[{key:"takeBinaryData",value:function takeBinaryData(binData){if(this.buffers.push(binData),this.buffers.length===this.reconPack.attachments){var packet=reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),packet}return null}},{key:"finishedReconstruction",value:function finishedReconstruction(){this.reconPack=null,this.buffers=[]}}]),BinaryReconstructor}(),parser=Object.freeze({__proto__:null,protocol:5,get PacketType(){return PacketType},Encoder:Encoder,Decoder:Decoder});function on(obj,ev,fn){return obj.on(ev,fn),function subDestroy(){obj.off(ev,fn)}}var RESERVED_EVENTS=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1}),Socket=function(_Emitter){_inherits(Socket,_Emitter);var _super=_createSuper(Socket);function Socket(io,nsp,opts){var _this;return _classCallCheck(this,Socket),(_this=_super.call(this)).connected=!1,_this.receiveBuffer=[],_this.sendBuffer=[],_this.ids=0,_this.acks={},_this.flags={},_this.io=io,_this.nsp=nsp,opts&&opts.auth&&(_this.auth=opts.auth),_this.io._autoConnect&&_this.open(),_this}return _createClass(Socket,[{key:"disconnected",get:function get(){return!this.connected}},{key:"subEvents",value:function subEvents(){if(!this.subs){var io=this.io;this.subs=[on(io,"open",this.onopen.bind(this)),on(io,"packet",this.onpacket.bind(this)),on(io,"error",this.onerror.bind(this)),on(io,"close",this.onclose.bind(this))]}}},{key:"active",get:function get(){return!!this.subs}},{key:"connect",value:function connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen(),this)}},{key:"open",value:function open(){return this.connect()}},{key:"send",value:function send(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];return args.unshift("message"),this.emit.apply(this,args),this}},{key:"emit",value:function emit(ev){if(RESERVED_EVENTS.hasOwnProperty(ev))throw new Error('"'+ev.toString()+'" is a reserved event name');for(var _len2=arguments.length,args=new Array(_len2>1?_len2-1:0),_key2=1;_key2<_len2;_key2++)args[_key2-1]=arguments[_key2];args.unshift(ev);var packet={type:PacketType.EVENT,data:args,options:{}};if(packet.options.compress=!1!==this.flags.compress,"function"==typeof args[args.length-1]){var id=this.ids++,ack=args.pop();this._registerAckCallback(id,ack),packet.id=id}var isTransportWritable=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable,discardPacket=this.flags.volatile&&(!isTransportWritable||!this.connected);return discardPacket||(this.connected?(this.notifyOutgoingListeners(packet),this.packet(packet)):this.sendBuffer.push(packet)),this.flags={},this}},{key:"_registerAckCallback",value:function _registerAckCallback(id,ack){var _this2=this,timeout=this.flags.timeout;if(void 0!==timeout){var timer=this.io.setTimeoutFn((function(){delete _this2.acks[id];for(var i=0;i<_this2.sendBuffer.length;i++)_this2.sendBuffer[i].id===id&&_this2.sendBuffer.splice(i,1);ack.call(_this2,new Error("operation has timed out"))}),timeout);this.acks[id]=function(){_this2.io.clearTimeoutFn(timer);for(var _len3=arguments.length,args=new Array(_len3),_key3=0;_key3<_len3;_key3++)args[_key3]=arguments[_key3];ack.apply(_this2,[null].concat(args))}}else this.acks[id]=ack}},{key:"packet",value:function packet(_packet){_packet.nsp=this.nsp,this.io._packet(_packet)}},{key:"onopen",value:function onopen(){var _this3=this;"function"==typeof this.auth?this.auth((function(data){_this3.packet({type:PacketType.CONNECT,data:data})})):this.packet({type:PacketType.CONNECT,data:this.auth})}},{key:"onerror",value:function onerror(err){this.connected||this.emitReserved("connect_error",err)}},{key:"onclose",value:function onclose(reason,description){this.connected=!1,delete this.id,this.emitReserved("disconnect",reason,description)}},{key:"onpacket",value:function onpacket(packet){var sameNamespace;if(packet.nsp===this.nsp)switch(packet.type){case PacketType.CONNECT:if(packet.data&&packet.data.sid){var id=packet.data.sid;this.onconnect(id)}else this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case PacketType.EVENT:case PacketType.BINARY_EVENT:this.onevent(packet);break;case PacketType.ACK:case PacketType.BINARY_ACK:this.onack(packet);break;case PacketType.DISCONNECT:this.ondisconnect();break;case PacketType.CONNECT_ERROR:this.destroy();var err=new Error(packet.data.message);err.data=packet.data.data,this.emitReserved("connect_error",err)}}},{key:"onevent",value:function onevent(packet){var args=packet.data||[];null!=packet.id&&args.push(this.ack(packet.id)),this.connected?this.emitEvent(args):this.receiveBuffer.push(Object.freeze(args))}},{key:"emitEvent",value:function emitEvent(args){if(this._anyListeners&&this._anyListeners.length){var listeners,_iterator=_createForOfIteratorHelper(this._anyListeners.slice()),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var listener;_step.value.apply(this,args)}}catch(err){_iterator.e(err)}finally{_iterator.f()}}_get(_getPrototypeOf(Socket.prototype),"emit",this).apply(this,args)}},{key:"ack",value:function ack(id){var self=this,sent=!1;return function(){if(!sent){sent=!0;for(var _len4=arguments.length,args=new Array(_len4),_key4=0;_key4<_len4;_key4++)args[_key4]=arguments[_key4];self.packet({type:PacketType.ACK,id:id,data:args})}}}},{key:"onack",value:function onack(packet){var ack=this.acks[packet.id];"function"==typeof ack&&(ack.apply(this,packet.data),delete this.acks[packet.id])}},{key:"onconnect",value:function onconnect(id){this.id=id,this.connected=!0,this.emitBuffered(),this.emitReserved("connect")}},{key:"emitBuffered",value:function emitBuffered(){var _this4=this;this.receiveBuffer.forEach((function(args){return _this4.emitEvent(args)})),this.receiveBuffer=[],this.sendBuffer.forEach((function(packet){_this4.notifyOutgoingListeners(packet),_this4.packet(packet)})),this.sendBuffer=[]}},{key:"ondisconnect",value:function ondisconnect(){this.destroy(),this.onclose("io server disconnect")}},{key:"destroy",value:function destroy(){this.subs&&(this.subs.forEach((function(subDestroy){return subDestroy()})),this.subs=void 0),this.io._destroy(this)}},{key:"disconnect",value:function disconnect(){return this.connected&&this.packet({type:PacketType.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}},{key:"close",value:function close(){return this.disconnect()}},{key:"compress",value:function compress(_compress){return this.flags.compress=_compress,this}},{key:"volatile",get:function get(){return this.flags.volatile=!0,this}},{key:"timeout",value:function timeout(_timeout){return this.flags.timeout=_timeout,this}},{key:"onAny",value:function onAny(listener){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(listener),this}},{key:"prependAny",value:function prependAny(listener){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(listener),this}},{key:"offAny",value:function offAny(listener){if(!this._anyListeners)return this;if(listener){for(var listeners=this._anyListeners,i=0;i<listeners.length;i++)if(listener===listeners[i])return listeners.splice(i,1),this}else this._anyListeners=[];return this}},{key:"listenersAny",value:function listenersAny(){return this._anyListeners||[]}},{key:"onAnyOutgoing",value:function onAnyOutgoing(listener){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(listener),this}},{key:"prependAnyOutgoing",value:function prependAnyOutgoing(listener){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(listener),this}},{key:"offAnyOutgoing",value:function offAnyOutgoing(listener){if(!this._anyOutgoingListeners)return this;if(listener){for(var listeners=this._anyOutgoingListeners,i=0;i<listeners.length;i++)if(listener===listeners[i])return listeners.splice(i,1),this}else this._anyOutgoingListeners=[];return this}},{key:"listenersAnyOutgoing",value:function listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}},{key:"notifyOutgoingListeners",value:function notifyOutgoingListeners(packet){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){var listeners,_iterator2=_createForOfIteratorHelper(this._anyOutgoingListeners.slice()),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var listener;_step2.value.apply(this,packet.data)}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}}}}]),Socket}(Emitter);function Backoff(opts){opts=opts||{},this.ms=opts.min||100,this.max=opts.max||1e4,this.factor=opts.factor||2,this.jitter=opts.jitter>0&&opts.jitter<=1?opts.jitter:0,this.attempts=0}Backoff.prototype.duration=function(){var ms=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var rand=Math.random(),deviation=Math.floor(rand*this.jitter*ms);ms=0==(1&Math.floor(10*rand))?ms-deviation:ms+deviation}return 0|Math.min(ms,this.max)},Backoff.prototype.reset=function(){this.attempts=0},Backoff.prototype.setMin=function(min){this.ms=min},Backoff.prototype.setMax=function(max){this.max=max},Backoff.prototype.setJitter=function(jitter){this.jitter=jitter};var Manager=function(_Emitter){_inherits(Manager,_Emitter);var _super=_createSuper(Manager);function Manager(uri,opts){var _this,_a;_classCallCheck(this,Manager),(_this=_super.call(this)).nsps={},_this.subs=[],uri&&"object"===_typeof(uri)&&(opts=uri,uri=void 0),(opts=opts||{}).path=opts.path||"/socket.io",_this.opts=opts,installTimerFunctions(_assertThisInitialized(_this),opts),_this.reconnection(!1!==opts.reconnection),_this.reconnectionAttempts(opts.reconnectionAttempts||1/0),_this.reconnectionDelay(opts.reconnectionDelay||1e3),_this.reconnectionDelayMax(opts.reconnectionDelayMax||5e3),_this.randomizationFactor(null!==(_a=opts.randomizationFactor)&&void 0!==_a?_a:.5),_this.backoff=new Backoff({min:_this.reconnectionDelay(),max:_this.reconnectionDelayMax(),jitter:_this.randomizationFactor()}),_this.timeout(null==opts.timeout?2e4:opts.timeout),_this._readyState="closed",_this.uri=uri;var _parser=opts.parser||parser;return _this.encoder=new _parser.Encoder,_this.decoder=new _parser.Decoder,_this._autoConnect=!1!==opts.autoConnect,_this._autoConnect&&_this.open(),_this}return _createClass(Manager,[{key:"reconnection",value:function reconnection(v){return arguments.length?(this._reconnection=!!v,this):this._reconnection}},{key:"reconnectionAttempts",value:function reconnectionAttempts(v){return void 0===v?this._reconnectionAttempts:(this._reconnectionAttempts=v,this)}},{key:"reconnectionDelay",value:function reconnectionDelay(v){var _a;return void 0===v?this._reconnectionDelay:(this._reconnectionDelay=v,null===(_a=this.backoff)||void 0===_a||_a.setMin(v),this)}},{key:"randomizationFactor",value:function randomizationFactor(v){var _a;return void 0===v?this._randomizationFactor:(this._randomizationFactor=v,null===(_a=this.backoff)||void 0===_a||_a.setJitter(v),this)}},{key:"reconnectionDelayMax",value:function reconnectionDelayMax(v){var _a;return void 0===v?this._reconnectionDelayMax:(this._reconnectionDelayMax=v,null===(_a=this.backoff)||void 0===_a||_a.setMax(v),this)}},{key:"timeout",value:function timeout(v){return arguments.length?(this._timeout=v,this):this._timeout}},{key:"maybeReconnectOnOpen",value:function maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}},{key:"open",value:function open(fn){var _this2=this;if(~this._readyState.indexOf("open"))return this;this.engine=new Socket$1(this.uri,this.opts);var socket=this.engine,self=this;this._readyState="opening",this.skipReconnect=!1;var openSubDestroy=on(socket,"open",(function(){self.onopen(),fn&&fn()})),errorSub=on(socket,"error",(function(err){self.cleanup(),self._readyState="closed",_this2.emitReserved("error",err),fn?fn(err):self.maybeReconnectOnOpen()}));if(!1!==this._timeout){var timeout=this._timeout;0===timeout&&openSubDestroy();var timer=this.setTimeoutFn((function(){openSubDestroy(),socket.close(),socket.emit("error",new Error("timeout"))}),timeout);this.opts.autoUnref&&timer.unref(),this.subs.push((function subDestroy(){clearTimeout(timer)}))}return this.subs.push(openSubDestroy),this.subs.push(errorSub),this}},{key:"connect",value:function connect(fn){return this.open(fn)}},{key:"onopen",value:function onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");var socket=this.engine;this.subs.push(on(socket,"ping",this.onping.bind(this)),on(socket,"data",this.ondata.bind(this)),on(socket,"error",this.onerror.bind(this)),on(socket,"close",this.onclose.bind(this)),on(this.decoder,"decoded",this.ondecoded.bind(this)))}},{key:"onping",value:function onping(){this.emitReserved("ping")}},{key:"ondata",value:function ondata(data){try{this.decoder.add(data)}catch(e){this.onclose("parse error",e)}}},{key:"ondecoded",value:function ondecoded(packet){var _this3=this;nextTick((function(){_this3.emitReserved("packet",packet)}),this.setTimeoutFn)}},{key:"onerror",value:function onerror(err){this.emitReserved("error",err)}},{key:"socket",value:function socket(nsp,opts){var socket=this.nsps[nsp];return socket||(socket=new Socket(this,nsp,opts),this.nsps[nsp]=socket),socket}},{key:"_destroy",value:function _destroy(socket){for(var nsps,_i=0,_nsps=Object.keys(this.nsps);_i<_nsps.length;_i++){var nsp=_nsps[_i],_socket;if(this.nsps[nsp].active)return}this._close()}},{key:"_packet",value:function _packet(packet){for(var encodedPackets=this.encoder.encode(packet),i=0;i<encodedPackets.length;i++)this.engine.write(encodedPackets[i],packet.options)}},{key:"cleanup",value:function cleanup(){this.subs.forEach((function(subDestroy){return subDestroy()})),this.subs.length=0,this.decoder.destroy()}},{key:"_close",value:function _close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}},{key:"disconnect",value:function disconnect(){return this._close()}},{key:"onclose",value:function onclose(reason,description){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",reason,description),this._reconnection&&!this.skipReconnect&&this.reconnect()}},{key:"reconnect",value:function reconnect(){var _this4=this;if(this._reconnecting||this.skipReconnect)return this;var self=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{var delay=this.backoff.duration();this._reconnecting=!0;var timer=this.setTimeoutFn((function(){self.skipReconnect||(_this4.emitReserved("reconnect_attempt",self.backoff.attempts),self.skipReconnect||self.open((function(err){err?(self._reconnecting=!1,self.reconnect(),_this4.emitReserved("reconnect_error",err)):self.onreconnect()})))}),delay);this.opts.autoUnref&&timer.unref(),this.subs.push((function subDestroy(){clearTimeout(timer)}))}}},{key:"onreconnect",value:function onreconnect(){var attempt=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",attempt)}}]),Manager}(Emitter),cache={};function lookup(uri,opts){"object"===_typeof(uri)&&(opts=uri,uri=void 0);var parsed=url(uri,(opts=opts||{}).path||"/socket.io"),source=parsed.source,id=parsed.id,path=parsed.path,sameNamespace=cache[id]&&path in cache[id].nsps,newConnection,io;return opts.forceNew||opts["force new connection"]||!1===opts.multiplex||sameNamespace?io=new Manager(source,opts):(cache[id]||(cache[id]=new Manager(source,opts)),io=cache[id]),parsed.query&&!opts.query&&(opts.query=parsed.queryKey),io.socket(parsed.path,opts)}return _extends(lookup,{Manager:Manager,Socket:Socket,io:lookup,connect:lookup}),lookup}));